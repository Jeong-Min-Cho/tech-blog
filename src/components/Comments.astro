---
interface Props {
  pageId: string;
  pageTitle: string;
}

const { pageId, pageTitle } = Astro.props;
const appId = import.meta.env.PUBLIC_CUSDIS_APP_ID || 'demo';
---

<section class="mt-12 pt-8 border-t border-skin-line">
  <h2 class="text-lg font-medium text-skin-base mb-4">Comments</h2>
  <div
    id="cusdis_thread"
    data-host="https://cusdis.com"
    data-app-id={appId}
    data-page-id={pageId}
    data-page-url={Astro.url.href}
    data-page-title={pageTitle}
  />
</section>

<script>
  function init() {
    const el = document.getElementById('cusdis_thread');
    if (!el || document.getElementById('cusdis-script')) return;
    const script = document.createElement('script');
    script.id = 'cusdis-script';
    script.src = 'https://cusdis.com/js/cusdis.es.js';
    script.async = true;
    document.body.appendChild(script);
  }
  init();
  document.addEventListener('astro:after-swap', init);
</script>
